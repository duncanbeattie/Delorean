/*
                       __---~~~~--__                      __--~~~~---__
                      `\---~~~~~~~~\\                    //~~~~~~~~---/'  
                        \/~~~~~~~~~\||                  ||/~~~~~~~~~\/ 
                                    `\\                //'
                                      `\\            //'
                                        ||          ||      
                              ______--~~~~~~~~~~~~~~~~~~--______              
                         ___ // _-~                        ~-_ \\ ___  
                        `\__)\/~                              ~\/(__/'          
                         _--`-___                            ___-'--_        
                       /~     `\ ~~~~~~~~------------~~~~~~~~ /'     ~\        
                      /|        `\         _________        /'        |\     
                     | `\   ______`\_      \--DMC--/     _/'______   /' |          
                     |   `\_~-_____\ ~-________________-~ /_____-~_/'   |  
                     `.     ~-__________________________________-~     .'       
                      `.      [_______/------|~~|------\_______]      .'
                       `\--___((____)(________\/________)(____))___--/'           
                        |>>>>>>||                            ||<<<<<<|
                        `\<<<<</'                            `\>>>>>/' 
              
       ==================================================================================

		          		              DeLorean.js
          				              
		          		       A jQuery timeline thing
				       
                     [ with unnecessary references to Back To The Future ]

       ==================================================================================
              
              
*/


$(function(){
	console.log('Great Scott!!!');
	$('.dlrn').DeLorean({
		data: 'assets/json/plutonium252.json', 
		/* devmode: true, */
		/* devnav: 'qnav', */
		wrapper: $('.dlrn')
	});
})




jQuery.fn.DeLorean = function() {
	$.Q = this
	$.Q.args = arguments[0] || {}
	$.Q.wrpr = $.Q.args.wrapper
	$.Q.dev = $.Q.args.devmode
	$.config
	$.scrub
	$.Q.points = []
	
	init = function(){
		trace = function(m){if($.Q.dev){console.log(m)}}
		trace('data file : '+$.Q.args.data)
		
		getData = function(f){
			$.getJSON(f, function(data,status) {
				if (status != "success") {trace("problem with json request");return;}
				trace('data loaded:')
			 	trace(data);
				$.Q.data = data
				$.config = data[0].config
				
				createTimeline()
				SetLayouts()
			});
		}
	}
	
	init()
	getData($.Q.args.data)
	

	SetLayouts = function(){
		trace('Setting Layouts')
		var data = $.Q.data;
		trace('data.length: '+data.length)
		trace('slides: '+data.length)
		trace(data[0].config)
		for(i=0;i<data.length;i++){
			trace('slide id: '+data[i].id)
			trace('slide id: '+data[i].tmpl.ptrn)
			var tmpl = data[i].tmpl
			var Zen = {
			  main: tmpl.ptrn,
			  h1: tmpl.header,
			  h2: tmpl.subhead,
			  text: '<p>'+tmpl.text+'</p>',
			  img: '<img src="'+tmpl.image_url+'" alt="" />',
			  bgimg: '<div class="bgimg" style="background-image:url('+tmpl.image_url+');"></div>',
			  btn: '<a href="'+tmpl.linkto+'">'+tmpl.linktext+'</a>'
			};
			addPoint(data[i])
			data[i].mkp = $.zc(Zen)
			trace(data[i].mkp)
			data[i].iid = i
		}
		
		loadup(data[0])
		
		if($.Q.dev && $.Q.args.devnav){quicknav()}
	}
	
	quicknav = function(){
		$.Q.wrpr.before('<div class="'+$.Q.args.devnav+'"></div>')
		$.Q.qnav = $($('.'+$.Q.args.devnav))
		var data = $.Q.data;
		for(i=0;i<data.length;i++){
			var lnk = '<span>'+data[i].name+'</span>'
			$($.Q.qnav).append(lnk)
		}
		$($.Q.qnav).children('span').each(function(ii, el){
			$(el).click(function(){
				loadup($.Q.data[ii])
			})
		})
	}
	
	createTimeline = function(){
		trace('timeline setup')
		$.config.range = $.config.end_point-$.config.start_point
		$.config.gp = 100/$.config.range
		trace($.config)
		
		var tzen = $.zc('div.timeline>div.scrubber')
		$.Q.wrpr.after(tzen)
		$.scrub = $('.timeline .scrubber')

		$($.scrub).css('width', (100*$.config.startzoom)+'%')
		for(i=0;i<$.config.range;i++){$.scrub.append($.zc('div.gap'))}
		$('.gap').css('width', $.config.gp+'%')
		

		$('.timeline').scroll(function(){
			/* this is really fucking ugly */
			$('#scrl').remove()
			$("<style id='scrl' type='text/css'> .timeline:after{ left:"+$('.timeline').scrollLeft()+"px; } </style>").appendTo("head");
		})
		
	}
	
	loadup = function(obj){
		trace('loadup: '+obj.name+' :: '+obj.iid)
		$('.scrubber .active').removeClass('active')
		$($.Q.points[obj.iid]).addClass('active')
		$($.Q.wrpr).html(obj.mkp)
	}
	
	addPoint = function(d){
		trace('adding point : '+d.id+' :: '+d.datetime)
		var n = d.datetime-$.config.start_point
		var lft = n*$.config.gp
		trace('n : '+n)
		trace('lft : '+lft)

		var Zen = {
		  main: '.pnt.'+d.id+'>span{@nom}',
		  nom: d.name
		};
		$('.gap:nth-child('+n+')').append($.zc(Zen))
		$('.'+d.id).click(function(){loadup($.Q.data[d.iid])})
		$.Q.points.push($('.'+d.id))
		trace($.Q.points.length)
	}
};





// paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/
window.log = function(){log.history = log.history || [];log.history.push(arguments);arguments.callee = arguments.callee.caller; if(this.console) console.log( Array.prototype.slice.call(arguments) );};
(function(b){function c(){}for(var d="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info, log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),a;a=d.pop();)b[a]=b[a]||c})(window.console=window.console||{});












































/*

7$77II77I7III77I?+=:........                                                                                                                                                                            
I$$$$$$$$$$$$$$$$$$$$$$I77I:                                                                                                                                                                            
I7$$$$$$$$$$$$$$$$$$$$$$$$$I? . ...:III7IIII?+=:,,..... .. .....                                                                                                                                        
.I$$$$$$$$$$$$$$$$$$$$$$$$$$7I... ?7$$$$$$$$$$$$$$$$77III7II....                                                                                                                                        
 I7$$$$$$$$$$$$$$$$$$$$$$$$$$II...II$$$$$$$$$$$$$$$$$$$$$$$$I. .   .. . .,,,,..... . .. .   ... .... . . .....                                                                                          
 ,I$$$$$$$$$$$$$$$$$$$$$$$$$$$7I..~I$$$$$$$$$$$$$$$$$$$$$$$$$I,.   . .II7$$$$$77II77IIIIIIIII   :,,...... ....                                                                                          
. I7$$$777$77$IIIIIIII$$$$$$7$$I. .I$$$$$$$$$$$$$$$$$$$$$$$$$7I......II$$$$$$$$$$$$$$$$$$$$$I?  ~II77IIIIIIII+...     ............. ....                                                                
. ,I77777777777I.. . :I$7777777$I. .7$$$$$$$$$$$$$$$$$$$$$$$$$$I. . .I$$$$$$$$$$$$$$$$$$$$$$$II. .I7$$$$$$$$$7I..    ...==~~~:::,,,,....                                                                
   I77777777777I.  .. I777777777I.. I777$7$777$$$$77777$$$$7$$77=.. .I$$$$$$$$$$$$$$$$$$$$$$$$7+. ,I$$$$$$$$$$7I     ...I77777777777+..+.                                                               
...:777777777777+    .:I77777777II. =I7777777777I:....?777777777I=. .I7$$$$$$$$$$$$$$$$$$$$$$$$I....I$$$$$$$$$$7I..   .=7$$$$$$$$$$I  .II~.. .                                                          
.. .I77777777777I.   .,I777777777I. .I7777777777I ... .7777777777I,. ~I$$$$$$$$$$$$$$$$$$$$$$$$$I.. ?I$$$$$$7$$$7I ....I$7$$$$$$$$$I  =I$I?...                                                          
    I77777777777IIIIIIII777777777I...~I777777777I?  .  .I777777777I. .?777777777777777$7$7$$7$$77I. .?I77777777777I.. ,I7777777777II. I$$$7I.  ...  . ...... ... ... ...                                
   .+IIIIIIIIIIIIIIIIIIIIIIIIIIII7. ..II777777777I~. ...=I77777777I7 ..I777777777777I?,,,:::::====~ ..II77777777777I. +77777777777I..:I$$$$$IIIIIIIIIII?~..:+++~~~...                                   
   ..IIIIIIIIIIIIIIIIIIIIIIIIIIII..  .~II77IIIIII7I..   .IIIIIII7III,..,I77777777777I...              .I77777777777I:.II777777777II..+I$$$$$$$$$$$$$$$$$II..7I7777I+ IIIIII, ..:::,.   ..... . .        
   ..IIIIIIIIIIIIIIIIIIIIIIIIIIII=.....IIIIIIIIIIII=    ..IIIIIIIIII7 ..I77777777777I~..               .I77777777777I~I77777777777:..I77777777777777777777II..II$$$$7..I7$$7I..?I$7I ..IIII? . .        
   ..=IIIIIIIIIIIIIIIIIIIIIIIIIIIII,.. +IIIIIIIIIII7.   ..=IIIIIIIIIII..~IIIIIIIIIIIII.                .IIIIIIIIIIIIIIIIIIIIIIIII7..:I777777777777777777777I? .~I$$$7I=.7I$$7I: II$$I:..77$7+. .        
   . .IIIIIIIIIIIIIIIIIIIIIIIIIIIIII....7IIIIIIIIIII..  .. ?IIIIIIIIII+..+7IIIIIIIIIIII.               ..I7IIIIIIIIIIIIIIIIIIIIII+. II77777777777777777777777I~..II7777I.,I7777I..I7$7I. ,I77I,.        
    ..7?IIIIIIIIIIIIIIIII7IIIIIIIIII?...IIIIIIIIIIII?.  .. .?IIIIIIIIII...IIIIIIIIIIIII:                .:IIIIIIIIIIIIIIIIIIIIIII. .IIIIIIIIIIIIIIIIIIIII77I7II+ .II777II..I777II .I77II..,I77I=        
   ...=I???????????I..    I?????????I~ .7?IIIIIIIIIIIIIIIIIII?IIIIIIIIII...IIIIIIIIIIIII...               =IIIIIIIIIIIIIIIIIIIIII. ...~77IIIIIIIIIIIIIIIIIIIIIII+..~IIIIII,.7IIIII..II77I...II7I:.      
   ....I????????????+ ....=I?????????I..:II??I??I???I??I??I????????????I.. IIIIIIIIIIIII....              .IIIIIIIIIIIIIIIIIIIII?7I?. ..,7I?IIIIIIIIIIIIIIIIIIIII?  77IIII7..IIIII7, 7IIII..:IIII:.     
       7????????????I. ... 7?????????I:..I??????????????????????????????+...II?I??????I?7...              ..7????????I??I?????I???I?III.....IIIIIIIIIIIIIIIIIIIIIII. =IIIIII..?IIIII..+IIII=..IIII=  .. 
       I????????????I.     7?????????I? .?I?????????????????????????????I. .I???????????I+                . I??????????????????????????I7, ...?7I?IIIIIIIIIIIIIIII?I .?I????I .I????I..??I?I..,II?I: .. 
       :????????????I?... .I??????????I...I?????????????????????????????II. .I???????????I, . ..    .     ...I????????????????????????????II... :II?????????????????I. =?????I..I???II..I???I. .7??I..  
       .?????????????IIIIII???????????I, .I??????????????????????????????I...=I???????????I. . .  .....   .  I???????????II?????????????????II~...,I????????????????I?..I?????+ ~I???I?.,I???? .I???=.. 
       .I?????????????????????????????I? .+I?????????????????????????????+I...II????????????IIIIIIIIIIIIIIIIIII???????????I II?????????????????II... II??????????????I?.,I+??+I=.+7?++I+ :I??I? .I??I:  
        I??????????????????????????????I .,I?????????7.        .I?????????I= ..I??????????????????????????????????????????I?...?I?????????????????I?  .:I??????????????I.~I++++I..I?+++I..+I++I=..I++I. 
        I?+?????????????????????????+++I ..I?????????I+         I?????????+I.. +???????????????????????????????????????????I. ...II?????????????????I~...II???I?:~=~+++? .IIIIII. .III??...?????. ~II?= 
        I+++++++++++++++++++++++++++++I?.  I+?+++++++?I.        :I+++++?+++I....I++?+???++?++++??++++?++??+++?++++++???+??+I... .. .I?+?++++?+??++?+++II.  =I+?I...    . . .... . . .  ..  ....  . .... 
       .I+++++++++++++++++++++++++++++I,.  =++++++++++7,        .I?+++++++++: ..:I++?+++++++++++++++++++++++++++++++++++++++,........=I?++++++++++++++++I+. ,7?+I..     ....  . ... ..     .  .. ... .. 
       .I++++++++++++++++++++++++++++I=.  .,?+++++++++??        .=I+++++++++I.   .I7++++++++++++++++++++++++++++++++++++++++?.      ....II++++++++++++++++II...III.. ..                                 
        I?++++++++++++++++++++++++++I~  ....?++++++++++I        ..I+++++++++I.   ..,I?++++++++++++++++++++++++++++++++++++++I. .   .... .:II++++++++++++++++I= .?II..                                   
       .IIIIIIIIIIIIIIIIIIIII?????~....    .???????????+        ..~==========~       .,=IIIIIIIIIIIIIIIIIIIII????????????????,..          ..IIIIIIIIIIIIIII????+ .+I ..                            . .  
        ..                  ... .. . ..    . .       ...        ..        .  .       . .                   ...                ..           ...   ..     ....... ......                            ..... 
       .....         .  ......  ........ ..... .                .       .    ....     ..    .  .. . ..    . ...............  .....::: .....,::::~==, +++++++++++???????=. ...:::~~~~~~++++++???????=... 
       . .??????????????..,I?++++????I+...   ?IIIIIIIIIIIIIIIIIIIII7.?7II???????~    +7????????I..I?????????????????????I.+7????????I...I????????+I,:I+++++++++++++++++?I...:I??+++++?++++++++++++I, .  
       ...I++++++++++++?.:+++++++++++++I  .  I?++++++++++++++++++++I.I+++++++++?.    ??++++++++? +I+++++++++++++++++++++?.I++++++++++.. I++++++++?I.?++++++++++++++++++++I..I?+++++++++++++++++++??. .  
        ..???++?++?+++?I.?+?+???+??+++?I.. ..I+??++++++++++?+++++++7:I?+?++++++I. .. I+?+++++??I.I?++++???++++++++++++??::I?++++?+??,...I+++++?++I~.I+?+++++???????+?+++?I..I?++?++?++++?++?+?+++I.     
        ..I????????I===~.????I....I????I  . :I?????????????????????II??????????I.   ,I?????????I~I??????????????????????.??????????I . ,?????????I..?????????????????????I..I???????????????????I+      
        .  . .I?????   .=????+ . .?????+. ..+?????????????????????I~I??????????I . .+??????????II??????????????????????I.I?????????I. .I?????????+.?????????????????????I?.=+?????????IIIIIIIIIII..     
          . ..?????,.. .?????.....7????,....I?????????????????????I.I?????????I+....I?????????I=I??????????????????????++?????????I?  ,I????????I..I????????7.,++???????I, I?????????I~.  ... . ...     
          .  ?????I.....????I ....????I. .. I???????????II7IIIIIII~=??????????I,....I?????????I.IIIII7??????????I+,,.. .I?????????I.. I?????????? II????????, .~????????+.=I????????I7IIIII7I..         
          .. I????~.. .,????? ...=????~     I???????????+..     ...I??????????I  ..:?????????7?.    .I??????????I......,?????????I?. ~I????????I.,I?????????..,I???????I..I?????????????????,..         
           .=????I.... ?????:. ..I???I    .,I??????????I        ..:I?????????I:. ..I?????????I..   .=7??????????=     .I?????????I..,I?????????7.I????????II77?????????? ??????????????????I            
          ..I????=. ...I?????II??????~    .=???????????IIIIIIIII7:???????????I.. .=I????????I?..   .I??????????I.    .:I????????I= .II????????I~?I????????????????????I..I????????????????I.            
           .II?II.....=?IIII?IIIIIIII..   .IIIIIIIIIIIIIIIIIIII?I,IIII?IIIIII~   .IIIIIIIIIII...   .IIIIIIIIIIII.    .I?IIIIIIIII. .II??IIIII7I.IIIIIIIIIII?IIIIIII?II .IIIIIIIIIIIIIIIIII .            
          .+IIII~    .:?IIIIIIIIIIII,. .  ,IIIIIIIIIIIIIIIIIIIII:?IIIIIIIIIII....IIIIIIIIIII~.   . ~IIIIIIIIIII~  ...?IIIIIIIIII...IIIIIIIII?I.?IIIIIIIIIIIIIIIIIIII:...IIIIIIIIIII.     .              
          ,7IIII     ...::::::...... ..   IIIIIIIIIIIIIIIIIIIIII:IIIIIIIIII?,.  ~IIIIIIIIIII.......IIIIIIIIII?I. ...:IIIIIIIIIII .IIIIIIIIIII,+IIIIIIIIIIIIIIIIIII.. ..IIIIIIIIIII::::::::..            
    . . ..  . ..... .   ...... . .    ....IIIIIIIIIIIIIIIIIIIII?IIIIIIIIIIII .. IIIIIIIIIII+    ..=IIIIIIIIIII,.. ..7IIIIIIIIII, ~7IIIIIIIII~.IIIIIIIIIIIIIIIIIIIII. .?IIIIIIIIIIIIIIIIIII .            
     .,IIIIIIIIII.+IIII.=IIII? =IIIIIII,.?IIIIIIIIIIIIIIIIIIIII.IIIIIIIIIII~. .,IIIIIIIIII?.     ,IIIIIIIIII7+  . ..IIIIIIIIIIIIIIIIIIIIIIII,IIIIIIIIII:.?IIIIIIIIII +IIIIIIIIIIIIIIIIIII..             
   ...I77IIIIIII:.IIII,.IIIII..III7777I. 7IIII7IIIIIIIIIIIIIII,=IIIII77III7...=IIIIIIII7II.     .IIIIIIIII7II    ..III77IIIIIIIIIIIIIIIIIII.IIII7III77? .=I7IIIIIII7I77IIIIII7IIIIIII7II                
   ...777777777I.+II7?..I777?.?I7II~~~:.?I777777777I?+++~==~::.I77777777777IIII7777777777.      ~I777777777I,.   .=I77777777777777777777II ?I7777777II...?7777777777I7777777777777777II.                
     .+=?777I:..~777I..:7777 :777I+=++ .I7777777777I        ..II77777777777777777777777I.   ..  I777777777II .   .I77777777777777777777I:.II77777777I....I77777III77IIIIIIIIII?+=~::,...                
    ... I777I...I777I++I777I.I7777777?..I7777777777?.        ,I777777777777777777777777I    ....I777777777I:..    I7777777777777777777I+.II777IIII77,.. ~IIII++=~:,,.... . . ...... .                   
   .. ..777$. ..7777777777I,?7777777I..I7777777777I..        7777777777777777777777777I.     ..I777777777I~ ..   ..I77$$$$$77IIIIIII+. .:,,,......... . ....  . ........... ... .   ..                  
   ....+$$$7.. I$$$$$$$$$$I.I$$$IIII+.=I$7$$$7$$7I:.        .I$77$7$$7$$$$7$$$$7$$$$7I.     ..+I$$$$$$77I?...    ...=?II?+++=~:,.. . ..                                                                 
    . ,I$$7=..~7$$I:,I$$$7.~$$$7. ...:I7$$$$$$$$I=..        ,7$$$$$$$$$$$$$$$$$$$$$7I...    ..~~,,,,..........    .. .. .     ..   .  .       ..                                                        
   .. I$$$I...7$$$I.+7$$7=.7$$$$777? I7$$$$$$$$$I           .I7$$$77II77IIIIIIIIII?~.                                                                                                                   
   ..?$$$I, .I$$$I..7$$$?.I$$$$$$$I.I7$$$$$$$77I            ...,..... ... ... .. .. .                                                                                                                   
   .~7$$$~ .~7$$7~ +$$$7.~7$$$$$$I.,7IIIII??==::                                                                                                                                                        
   .I$$$+...7III+.=777?+........    ...   ... .                                                                                                                                                         
   +??+? . ... . .. .. .  ...  . ........ ..  . .                                                                                                                                                       
                                                          

*/